\documentclass[a4paper]{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{bussproofs}
\usepackage{mathtools}
\usepackage{verbatim}
\usepackage{dsfont}
\usepackage{mathabx}
\usepackage[all, 2cell]{xy}
\usepackage[all]{xy}
\usepackage{wasysym}
\usepackage{rotating}
\usepackage{geometry}
\usepackage{trfsigns}
\usepackage{cmll}
\usepackage{authblk}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{lipsum}
\usepackage{extpfeil}
\usepackage{soul}
\usepackage{graphicx}

\newcommand\mapsfrom{\mathrel{\reflectbox{\ensuremath{\mapsto}}}}

\theoremstyle{defin}
\newtheorem{defin}{Definition}

\theoremstyle{theorem}
\newtheorem{theorem}{Theorem}

\theoremstyle{prop}
\newtheorem{prop}{Proposition}

\theoremstyle{lemma}
\newtheorem{lemma}{Lemma}

\theoremstyle{ex}
\newtheorem{ex}{Example}

\theoremstyle{col}
\newtheorem{col}{Corollary}

\theoremstyle{claim}
\newtheorem{claim}{Claim}

\author{Daniel Rogozin}
\date{}
\title{The finite base property for subreducts of representable relation algebras}

\begin{document}

\maketitle

\section{The Relation Algebras Background}

We recall the basic definitions and results about relation algebras \cite{hirsch2002relation} \cite{maddux2006relation}.

\begin{defin}
  $ $

    A relation algebra is an algebra $\mathcal{R} = \langle R, 0, 1, +, -, ;, {}^{\smile}, {\bf 1 }\rangle$ such that $\langle R, 0, 1, +, - \rangle$ is a Boolean algebra and the following
    equations hold, for each $a, b, c \in R$:
    \begin{enumerate}
      \item $a ; (b ; c) = (a ; b) ; c$
      \item $(a + b) ; c = (a ; c) + (b ; c)$
      \item $a ; {\bf 1} = a$
      \item $a^{\smile \smile} = a$
      \item $(a + b)^{\smile} = a^{\smile} + b^{\smile}$
      \item $(a ; b)^{\smile} = b^{\smile} ; a^{\smile}$
      \item $a^{\smile} ; (- (a ; b)) \leq - b$
    \end{enumerate}
    where $a \leq b$ iff $a + b = b$. ${\bf RA}$ denotes the class of all relation
    algebras.
\end{defin}
A relation algebra is called symmetric, if every element is self-converse. A relation algebra is called integral, if
\begin{center}
  $a ; b = 0 \Rightarrow a = 0 \text{ or } b = 0$.
\end{center}

\begin{defin}
    A proper relation algebra is an algebra $\mathcal{R} = \langle R, 0, 1, \cup, -, |, {}^{\smile}, {\bf 1 }\rangle$ such that $R \subseteq \mathcal{P}(W)$, where $W$ is an equivalence relation; $0 = \emptyset$; $1 = W$; $\cap$, $\cup$, $-$ are set-theoretic intersection, union, and
    complement respectively; $|$ is relation composition, ${}^{\smile}$ is relation converse, ${\bf 1}$ is a
    diagonal relation restricted to $W$, that is:
    \begin{enumerate}
    \item $a | b = \{ \langle x, z \rangle \: | \: \exists y \: \langle x, y \rangle \in a \: \& \: \langle y, z \rangle \in b \}$
    \item $a^{\smile} = \{ \langle x, y \rangle \: | \: \langle y, x \rangle \in a \}$
    \item ${\bf 1} = \{ \langle x, y \rangle \: | \: x = y \}$
    \end{enumerate}
      The class of all proper relation algebras is denoted as ${\bf PRA}$. ${\bf Rs}$ is the class of all relation set algebras, proper relation algebra with a diagonal subrelation as an identity. ${\bf RRA}$ is the class of all representable relation algebras, that is, the closure of ${\bf PRA}$ under isomorphic copies. That is,
      ${\bf RRA} = {\bf IPRA}$.
\end{defin}
Note that the (quasi)equational theories of those classes coincide, that is
\begin{center}
  ${\bf IPRA} = {\bf RRA} = {\bf SP}{\bf Rs}$
\end{center}
${\bf RRA}$ is a variety, but it cannot be defined by any set of first-order formulas. It is also known that ${\bf RA}$ and ${\bf RRA}$ are equational classes, but ${\bf RRA}$ is not finitely axiomatisable.


\section{Join-semilattice ordered semigroups}

\begin{defin} A join-semilattice ordered semigroup (${\bf OS^{+}}$) is an algebra $\mathcal{S} = \langle S, ;, + \rangle$ such that $\langle S, ; \rangle$ is a semigroup, $\langle S, + \rangle$ is a join-semilattice and the following equations hold for each $a, b. c \in S$:

  \begin{enumerate}
    \item $a ; (b + c) = (a ; b) + (a ; c)$
    \item $(a + b) ; c = (a ; c) + (b ; c)$
  \end{enumerate}
\end{defin}
This class is clearly a variety since ${\bf OS^{+}}$ has the equational definition so far as $+$ is defined as an associative, idempotent, and commutative operation.

Let $A$ be a set of binary relations on some base set $W$ such that $R = \cup A$ is transitive and $\{ x, y \: | \: x R y \} = W$ as in Definition~\ref{rrs}. A representable join semilattice-ordered semigroup is an algebra isomorphic to some join semilattice-ordered semigroup having the form $\mathcal{A} = \langle A, |, \cup \rangle$ such that $;$ is a relation composition as above and $\cup$ is the set-theoretic union. If $\mathcal{A}$ is representable, then $\mathcal{A} \in {\bf I}({\bf R}(\cup, |))$. Let us recall some of underlying facts about representable join semilattice-ordered semigroups \cite{andreka1991representations}:

\begin{prop}
  $ $

  \begin{enumerate}
    \item Let $\mathcal{A} = \langle A, +, ; \rangle$ be a join semilattice-ordered semigroup such that, for all $a, b \in A$:
    \begin{enumerate}
      \item If $a \nleq b$, then there exists an atom $c \leq a$ and $c \nleq b$.
      \item If $c \leq a ; b$ and $c$ is an atom, then there exists an atom $a' \leq a$ such that $c \leq a' \cdot b$.
    \end{enumerate}
    then $\mathcal{A}$ is representable.
    \item Let $\mathcal{A} = \langle A, ; \rangle$ be a posemigroup, then $\mathcal{A}$ is representable and such a representation preserve any existing finite suprema and infima, if
    \begin{enumerate}
      \item The set of atoms is closed under $;$.
      \item $\mathcal{A}$ has enough atoms, that is, if $x \in \operatorname{At}(A)$ and $z, w \in A$, then $x \leq z ; w$ implies there exist atoms $z_1 \leq z$ and $w_1 \leq w$ such that $x \leq z_1 ; w_1$. If $z \nleq w$, then there exists an atom $x$ such that $x \leq z$ and $x \nleq w$.
    \end{enumerate}
  \end{enumerate}
\end{prop}

Recall that a class of structures ${\bf K}$ is called finitely axiomatisable iff both ${\bf K}$ and its complement are closed
ultraproducts and isomorphic copies.

It is known that the class of all representable join-semilattice ordered semigroups has no finite axiomatisation \cite{andreka1989union}. In other words,

\begin{theorem}
  ${\bf R}(\cup, |)$ is not finitely axiomatisable.
\end{theorem}

\subsection{The rainbow construction}

Let us provide a proof of this fact using the rainbow technique \cite{hirsch2002relation} to show that the complement of ${\bf ROS^{+}}$ is not closed ultraproducts. This construction sometimes exploits the similar construction used by Andr{\'e}ka \cite{andreka1991representations} and by Maddux \cite{maddux_1989}.
We note that representability is not decidable for finite relation algebras \cite{hirsch2001representability} and this result has several generalisations \cite{hirsch2012undecidability}. Moreover, representability is undecidable for lattice-ordered semigroups and ordered complemented semigroups \cite{neuzerling2016undecidability}. We use (more or less) a standard way of showing that the class of certain reducts of representable relation algebras has no finite axiomatisation, see \cite{hodkinson2000axiomatizability} \cite{hirsch1997step}.

First of all, we recall several definitions such as colourings. We provide a sequence of symmetric, integral, finite relation algebras $\{ \mathfrak{A}_n \}_{n < \omega}$ such that $\mathfrak{A}_n \notin {\bf RRA}$. The statement has been proved by Andreka \cite{andreka1991representations} and reproduced here \cite{andreka2011axiomatizability}.

Given $n < \omega$, the set of atoms $\operatorname{At}(\mathfrak{A}_n)$ consists of the following elements:
\begin{itemize}
\item identity: ${\bf 1}$, an atom with no colour,
\item white: ${\bf w}$,
\item greens: ${\bf g}_i$ for $1 \leq i \leq n$,
\item yellows: ${\bf y}_i$ for $1 \leq i \leq n$,
\item reds: ${\bf r}_i$ for $1 \leq i \leq n$,
\item blacks: ${\bf b}_i$ for $1 \leq i \leq n$,
\item ivory: ${\bf i}$.
\item orange: ${\bf o}$
\end{itemize}

We have the following steps:

\vspace{\baselineskip}

{\bf Step 1}. Let $\mathcal{A}_n$ be the Boolean algebra presented with the set of generators $\operatorname{At}(\mathfrak{A}_n)$ and the following relations for each $x \in \operatorname{At}(\mathfrak{A}_n)$ and for each $1 \leq i \leq n$.
\begin{enumerate}
  \item ${\bf w} + {\bf g}_i + {\bf y}_i = {\bf g}_i + {\bf y}_i$,
  \item ${\bf i} + {\bf y}_i + {\bf r}_i = {\bf y}_i + {\bf r}_i$.
\end{enumerate}

{\bf Step 2}. We define $S$, the set of two element subsets of $\mathcal{A}_n$:
\begin{center}
  $S = \{ \{ {\bf w}, {\bf r}_1 \} \} \cup \{ \{ {\bf g}_i, {\bf b}_i \} \: | \: 1 \leq i \leq n \} \cup
  \{ \{ {\bf y}_i, {\bf r}_i \} \: | \: 1 \leq i < n \} \cup \{ \{ {\bf y}_n, {\bf i}\} \}$.
\end{center}

{\bf Step 3}. The operations on $\mathfrak{A}_n$:
\begin{enumerate}
  \item $1 = \sum \operatorname{At}(\mathcal{A}_n)$,
  \item $x = x^{\smile}$,
  \item $0 ; x = 0 ; x = 0$,
  \item ${\bf 1} ; x = {\bf 1} ; x = x$,
  \item $x ; y = \begin{cases} {\bf o}, \text{ if $\{x, y\} \in S$} \\ 1, \text{ otherwise } \end{cases}$ \\ unless $x, y \in \{ 0, {\bf 1}\}$.
\end{enumerate}

{\bf Step 4}. Define the following quasi-idenity:
\begin{center}
  $\begin{array}{lll}
  & q_n = \bigwedge \limits_{1 \leq i \leq n} ( (x \leq x^{'}_i + x^{''}_i) \land (y \leq y^{'}_i + y^{''}_i)) \to & \\
  & x ; y \leq x ; y^{'}_1 + \sum \limits_{1 \leq i < n} (x^{'}_i ; y^{''}_i + x^{''}_i ; y^{'}_{i + 1}) + x^{'}_n ; y^{''}_n + x^{''}_n ; y&
  \end{array}$
\end{center}

\begin{lemma}

  \begin{enumerate}
    \item $q_n$ is valid in ${\bf RRA}$ for each $n < \omega$.
    \item $q_n$ fails in $\mathfrak{A}_n$.
  \end{enumerate}
\end{lemma}

\begin{proof}
  The valuation $\vartheta$ defined as:
  \begin{enumerate}
    \item $\vartheta(x) = {\bf w}$
    \item $\vartheta(x_i^{'}) = {\bf g}_i$
    \item $\vartheta(x_i^{''}) = {\bf y}_i$
    \item $\vartheta(y) = {\bf i}$
    \item $\vartheta(y_i^{'}) = {\bf r}_i$
    \item $\vartheta(y_i^{''}) = {\bf b}_i$
  \end{enumerate}
  falsifies $q_n$ in $\mathfrak{A}_n$.

  TODO: visualise the reason for non-representability.
\end{proof}

\subsection{Networks and games}

\begin{defin}
  Let $\mathcal{A}$ be a relation algebra. A network is a complete directed finite graph with edges labelled by elements of $\mathcal{A}$. Such a graph have the following form. $N = \langle U_N, E_N, l_N \rangle$, where $E_N = U_N \times U_N$ for some finite base set and $l_n : E_N \to \mathcal{A}$ is function mapping each edge to some atom of $A$. This function obey the following requirements:
  \begin{enumerate}
    \item $l_N(x,y) \leq {\bf 1}$ iff $x = y$
    \item $l_N(x, y) ; l_N(y,z) \geq l_N(x,z)$
  \end{enumerate}
  A network is called atomic if all the edges are labelled by atoms.
\end{defin}
Given two networks $N = \langle E_N, l_N \rangle$ and $N^{'} = \langle E_{N^{'}}, l_{N^{'}} \rangle$, $N$ is a subnetwork of $N^{'}$ ($N \subseteq N^{'}$, or $N^{'}$ refines $N$) if $E_N \subseteq E_{N^{'}}$ and for each $x,y \in U_N$, $l_{N^{'}}(x,y) = l_{N}(x,y)$.

\begin{defin}
  Let $n < \omega$. We define a game $\mathcal{G}_n(\mathcal{A})$ for two players $\forall$ (Abelard) and $\exists$ (H\'{e}lo\"{i}se). Abelard and H\'{e}lo\"{i}se build a finite chain of networks $N_0 \subseteq N_1 \dots \subseteq N_n$ as follows. In the first round $\forall$ picks an atom $\alpha$ and $\exists$ plays a network $N_0$ containing an edge $(m_0, n_0)$ such that $l_n(m_0, n_0) = \alpha$. If $\alpha \leq {\bf 1}$, then $m_0 = n_0$, otherwise $m_0 \neq n_0$. If $m_0 \neq n_0$, the edges $(m_0, n_0)$ and $(n_0, m_0)$ belong to Abelard. Suppose $N_{i-1}$ for $i < n$ has been played, then
  \begin{itemize}
    \item $\forall$ chooses an edge $(m, n) \in E_{N_{i - 1}}$ and atoms $x, y \in \operatorname{At}(\mathcal{A})$ such that $l_{N_{i - 1}}(m,n) \leq x ; y$.
    \item $\exists$ provides a network $N_i = \langle E_{N_i}, l_{N_i} \rangle \supseteq N_{i - 1}$ such that there exists
    $l \in U_{N_i}$ such that $l_{N_i}(m, l) = x$ and $l_{N_i}(l, n) = y$.
  \end{itemize}
  If $(m,n) \in E_i$ such that $m \neq n$ and $m, n \in U_{N_{i - 1}}$, then the owner of this edge is the same as in the previous round.
  The edges $(m, l)$ and $(l, n)$ and their converses belong to Abelard. The rest of the irreflexive edges belongs to H\'{e}lo\"{i}se. $\exists$ wins a match of the game $\mathcal{G}_n(\mathcal{A})$ if she can provide a network $N_i$ for each move of $\forall$ for each $i \leq n$.
  $\exists$ has a winning strategy if she can win all matches.
\end{defin}

This lemma has been proved by Hirsch and Hodkinson here \cite{hirsch1997step}. This lemma provide a criterion of representability for relation algebras.

\begin{lemma} \label{win}
  Let $\mathcal{A}$ be an atomic relation algebra. Then $\exists$ has a winning strategy in $\mathcal{G}_n({\mathcal{A}})$ for each $n < \omega$ iff $\mathcal{A}$ is elementary equivalent to some completely representable relation algebra. If $\exists$ has a winning strategy, then $\mathcal{A}$ is representable since ${\bf RRA}$ is elementary.
\end{lemma}

\subsection{The ultraproduct}

The second is to show that any non-trivial ultraproduct $\prod \limits_{D} \mathfrak{A}_n \in {\bf RRA}$, where $D$ is an ultrafilter over $\mathcal{P}(\omega)$. We show that via the rainbow technique. Let us define networks and games according to \cite{hirsch1997step}.

\begin{lemma}
  Any non-trivial ultraproduct of $\{ \mathfrak{A}_n \}_{n < \omega}$ is representable, that is, belongs to ${\bf RRA}$. The same statement for non-trivial ultraproduct of reducts $\{ \mathfrak{S}_n \}_{n < \omega}$ that belongs to ${\bf R}(\cup, |)$.
\end{lemma}

According to the following claim, $\exists$ has a winning strategy on cofinitely many algebras that allows her to win a game on the ultraproduct. Thus, according to Lemma~\ref{win}, the ultraproduct belongs to ${\bf RRA}$.

\begin{claim}
  Let $l < \omega$. $\exists$ has a winning strategy for $G_l(\mathfrak{A}_n)$ for cofinitely many algebras beloging to the sequence $\{ \mathfrak{A}_n \}_{n < \omega}$.
\end{claim}

Let us consider the following sequence of networks $\{ \mathcal{N}_n \}_{n < \omega}$ labelled by atoms of $\mathfrak{A}_n$.

\begin{enumerate}
  \item $n = 0$, then the $N_0 = \langle U_0, E_0, l_0 \rangle$ has the form:
\end{enumerate}

\xymatrix{
\\
&&&&& u \ar@(ul,ur) \ar@{-}[rr] && v \ar@(ul,ur)
}

\begin{claim}
\end{claim}

\subsection{The finite algebra on finite base for ${\bf R}(\cup, |)$ (or its failure)}

\bibliographystyle{plain}
\bibliography{Text}

\end{document}
