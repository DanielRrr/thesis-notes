\documentclass[a4paper]{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{bussproofs}
\usepackage{mathtools}
\usepackage{verbatim}
\usepackage{dsfont}
\usepackage{mathabx}
\usepackage[all, 2cell]{xy}
\usepackage[all]{xy}
\usepackage{wasysym}
\usepackage{rotating}
\usepackage{geometry}
\usepackage{trfsigns}
\usepackage{cmll}
\usepackage{authblk}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{lipsum}
\usepackage{extpfeil}
\usepackage{soul}
\usepackage{graphicx}
\usepackage{wasysym}

\newcommand\mapsfrom{\mathrel{\reflectbox{\ensuremath{\mapsto}}}}

\theoremstyle{defin}
\newtheorem{defin}{Definition}

\theoremstyle{theorem}
\newtheorem{theorem}{Theorem}

\theoremstyle{prop}
\newtheorem{prop}{Proposition}

\theoremstyle{lemma}
\newtheorem{lemma}{Lemma}

\theoremstyle{fact}
\newtheorem{fact}{Fact}

\theoremstyle{ex}
\newtheorem{ex}{Example}


\theoremstyle{col}
\newtheorem{col}{Corollary}

\theoremstyle{claim}
\newtheorem{claim}{Claim}

\author{Daniel Rogozin}
\date{}
\title{Notes on filtrations for logics that contain {\bf K5}}
\begin{document}

\maketitle

\section{Preliminaries}

Let $\mathcal{M} = \langle W, R_1, \dots, R_n, \vartheta \rangle$ be a Kripke model and $\Gamma$ a set of formulas closed under subformulas. An equivalence relation $\sim$ is set to have a finite index if the quotient set $W / \sim$ is finite. The equivalence relation $\sim_{\Gamma}$ induced by $\Gamma$ is defined as

\begin{center}
  $w \sim_{\Gamma} v \Leftrightarrow \forall \varphi \in \Gamma \: (\mathcal{M}, w \models \varphi \Leftrightarrow \mathcal{M}, v \models \varphi)$.
\end{center}

If $\Gamma$ is finite, then $\sim_{\Gamma}$ has a finite index. An equivalence relation $\sim$ respects $\sim_{\Gamma}$, if $w \sim v$ implies $w \sim_{\Gamma} v$.

\begin{defin}
  Let $\mathcal{M} = \langle W, R_1, \dots, R_n, \vartheta \rangle$ be a Kripke model and $\Gamma$ be a Sub-closed set formulas. A $\Gamma$-filtration of $\mathcal{M}$ is a model
  $\widehat{\mathcal{M}} = \langle \widehat{W}, \widehat{R_1}, \dots, \widehat{R_n}, \widehat{\vartheta} \rangle$ such that:
  \begin{enumerate}
    \item $\widehat{W} = W / \sim$, where $\sim$ is an equivalence relation having a finite index that respects $\Gamma$
    \item $\widehat{\vartheta}(p) = \{ [x]_{\sim} \: | \: x \in W \: \& \: x \in \vartheta(p)\}$
    \item For each $i \in I$ one has $\widehat{R}_i^{\text{min}} \subseteq \widehat{R}_i \subseteq \widehat{R}_i^{\text{max}}$. $\widehat{R}_{i, \sim}^{\text{min}}$ is the $i$-th minimal filtered relation on $\widehat{W}$ defined as
    \begin{center}
      $\hat{x} \widehat{R}_{i, \sim}^{\text{min}} \hat{y} \Leftrightarrow \exists x' \sim x \: \exists y' \sim y \: x R_i y$
    \end{center}
    $\widehat{R}_{\Gamma,i}^{\text{max}}$ is the $i$-th maximal filtered relation on $\widehat{W}$ induced by $\Gamma$ defined as
    \begin{center}
      $\hat{x} \widehat{R}_{\Gamma,i}^{\text{max}} \hat{y} \Leftrightarrow \forall \Box_i \varphi \in \Gamma \: (\mathcal{M}, x \models \Box_i \varphi \Rightarrow \mathcal{M}, y \models \varphi)$
    \end{center}
  \end{enumerate}
\end{defin}

If $\Phi$ is finite subset of $\Gamma$ and $\sim = \sim_{\Phi}$, then $\widehat{\mathcal{M}}$ is a definable $\Gamma$-filtration of $\mathcal{M}$ through $\Phi$. If $\sim = \sim_{\Gamma}$, then such a filtration by means of the definiton above is called \emph{strict}. A class of models $\mathbb{M}$ admits strict filtrations for models (ASF), if for every $\operatorname{Sub}$-closed set $\Gamma$ and for every $\mathcal{M} \in \mathbb{M}$ there exists a $\Gamma$ filtration of $\mathcal{M}$.
A class of frames $\mathbb{F}$ admits strict filtrations for frames, if for every $\operatorname{Sub}$-closed set $\Gamma$ and for every frame $\mathcal{F} \in \mathbb{F}$ and every model $\mathcal{M}$ over $\mathcal{F}$ there exists a $\Gamma$ filtration of $\mathcal{M}$. If $\mathcal{L}$ is canonical, then the ASF property for frames and ASF property for models are equivalent \cite[Theorem 2.10]{kikot2020completeness}.

\begin{lemma}
  Let $\Gamma$ be a finite set of formulas closed under subformulas and $\widehat{\mathcal{M}}$ a filtration of $\mathcal{M}$ through $\Gamma$, then for each $x \in W$ and for each $\varphi \in \Gamma$ one has
  \begin{center}
    $\mathcal{M}, x \models \varphi \Leftrightarrow \widehat{\mathcal{M}}, \hat{x} \models \varphi$
  \end{center}
\end{lemma}

\begin{defin} Let $\mathbb{F}$ be a class of Kripke frames and $\Gamma$ a finite set of formulas closed under subformulas. If for every model $\mathcal{M}$ over $\mathcal{F} \in \mathbb{F}$ there exists a model that is a $\Gamma$-definable filtration of $\mathcal{M}$, then $\mathbb{F}$ admits definable filtration. A class of models $\mathbb{M}$ admits definable filtration if for every $\mathcal{M} \in \mathbb{M}$ there exists a model belonging to the same class that is a definable $\Gamma$-filtration of $\mathcal{M}$.
\end{defin}

\begin{lemma}
  $ $

\begin{enumerate}
  \item Let $\mathcal{L}$ be a complete normal modal logic. If $\operatorname{Frames}(\mathcal{L})$ admits filtration, then $\mathcal{L}$ has the finite model property.
  \item If the class of models $\operatorname{Mod}(\mathcal{L})$ admits filtration, then $\mathcal{L}$ has the finite model property and it is Kripke complete as well.
\end{enumerate}
\end{lemma}

\begin{defin} A first-order formula is called Horn if it has the following form:

  \begin{center}
    $\forall x_1, \dots, x_n (x_{i_1} R x_{j_1} \land \dots \land x_{i_s} R x_{j_s} \rightarrow x_k R x_l)$
  \end{center}
\end{defin}

\begin{defin}
  Let $H$ be a Horn property and $\langle W, R \rangle$ a Kripke frame. A Horn closure of a binary relation $R$ is the minimal relation $R^{H}$ containing $R$ and satisfying $H$.
\end{defin}

\begin{lemma}
  $R^{H} = \bigcup \limits_{n < \omega} R_n$ where

  \begin{enumerate}
    \item $R_0 = R$.
    \item $R_{n + 1} = R_n \cup \{ (a, b) \in W \: | \: \exists \vec{c} \in W \: P(a, b, \vec{c})\}$, where $P$ is a premise of $H$.
  \end{enumerate}
\end{lemma}

\section{Filtrations for {\bf K5}}

$E$-closure (an Euclidean Horn closure of a binary relation) has the following equivalent definitions:
\begin{lemma} \label{equivHorn}
  Let $\mathcal{F} = \langle W, R \rangle$ be a Kripke frame.
  The following conditions are equivalent:

  \begin{enumerate}
    \item $R^{E}$ is the smallest Euclidean relation containing $R$.
    \item $R^{E} = \bigcup \limits_{i < \omega} R_i$, where
    \begin{itemize}
      \item $R_0 = R$
      \item $R_{n + 1} = R_n \cup (R^{-1}_n \circ R_n)$
    \end{itemize}
    \item $x R^E y$ iff there exists $n < \omega$ such that
    either $x R y$ or $\exists z_1, \dots, z_n$ with $z_1 R x$ and $z_{n - 1} R y$ and for each $1 < i \leq n$ one has
    either $z_{i - 1} R z_i$ or $z_i R z_{i - 1}$.
    \item $R^{E} = R \cup \bigcup \limits_{i < \omega} (R^{-1} \circ (R \circ R^{-1})^n \circ R)$.
  \end{enumerate}
\end{lemma}

\begin{proof}
$ $

\begin{enumerate}
  \item $(1) \Rightarrow (2)$
  Let us show that if $R^{E}$ is the smallest Euclidean relation containing $R$, then $R^{E} = \bigcup \limits_{i < \omega} R_i$. There are two inclusions:
  \begin{itemize}
    \item $R^{E} \subseteq \bigcup \limits_{i < \omega} R_i$. Recall that $R^{E}$ has the form (?):
    \begin{center}
      $R^{E} = \bigcap \{ R' \: | \: R \subseteq R', \forall a, b \in W \: R'(a,b) \Rightarrow \exists x \in W \: R'(x, a) \: \& \: R'(x, b)\}$
    \end{center}

    \item $\bigcup \limits_{i < \omega} R_i \subseteq R^{E}$.
    Let us show that $x R_n y$ for each $n < \omega$ implies $x R^E y$ by induction on $n$.
    If $n = 0$, then $x R y$, thus, $x R^{E} y$, since $R$ is a subrelation of $R^{E}$.
    Suppose $n = m + 1$ and $x R_{m + 1} y$. Let us show that $x R^{E} y$.
    From $x R_{m + 1} y$, one has $(x, y) \in R^n \cup (R^{-1}_n \circ R_n)$. There are two cases:
    \begin{itemize}
      \item $x R^n y$, one needs to merely apply the IH.
      \item $x R^{-1}_n \circ R_n y$. Then $\exists z \in W \: x R^{-1}_n z \: \& \: z R_n$. That is,
      $z R_n x$ and $z R_n y$ for some $z$. $R_n$ is already a subrelation of $R^E$. Thus,
      $z R^{E} x$ and $z R^{E} y$. That implies $x R^{E} y$.
    \end{itemize}
  \end{itemize}
  \item $(2) \Rightarrow (3)$
  Let $(x, y) \in R_m$, let us the statement by induction on $m$.
  \begin{enumerate}
    \item Suppose $m = 0$, then $x R y$, and the statement is shown putting $n = 0$.
    \item Suppose $m = p + 1$ and $x R_{p + 1} y$.
    Assume that either $x R y$ or $\exists z_1, \dots, z_p$ with $z_1 R x$ and $z_{p - 1} R y$ and for each $1 < i \leq p$ one has
    either $z_{i - 1} R z_i$ or $z_i R z_{i - 1}$.

    $x R_{p + 1} y$ implies $(x, y) \in R_{p} \cup (R^{-1}_p \circ R_p)$. If $(x, y) \in R_{p}$, then we merely apply the IH.
    Suppose $(x, y) \in R^{-1}_p \circ R_p$, then $(z, x) \in R_p$ and $(z, y) \in R_p$
  \end{enumerate}
  \item $(3) \Rightarrow (4)$
  Suppose either $x R y$ or there exist $n \geq 1$ and $z_1, \dots, z_n$ with $z_1 R x$ and $z_{n - 1} R y$ and for each $1 < i \leq n$ one has either $z_{i - 1} R z_i$ or $z_i R z_{i - 1}$.
  If $x R y$, then we are done. Otherwise there exists $n \geq 1$ with the condition above. Then $(x, y) \in R_{n + 1}$ that follows from the condition.
  \item $(4) \Rightarrow (1)$
\end{enumerate}
\end{proof}

\begin{lemma}
 Let $\mathcal{F} = \langle W, R \rangle$ be a Kripke frame. Let us define $R^{E} = \bigcup \limits_{i < \omega} R_i$ where:

 \begin{enumerate}
   \item $R_0 = R$
   \item $R_{n + 1} = R_n \cup ({R_n}^{-1} \circ R_n)$
 \end{enumerate}
 Then $R^{E}$ is Euclidean.
\end{lemma}

\begin{proof}
  Let $(x, y), (x, z) \in R^{E}$, one needs to show that $(y, z) \in R^{E}$.
  Clearly that $(x, y) \in R_i$ and $(x, z) \in R_j$ for some $i, j < \omega$. Thus, we need $(y, z) \in R_m$ for some $m$ depending on $i$ and $j$.

  Let us consider the following cases:
  \begin{enumerate}
    \item $i = 0$ and $j = 0$

    Suppose $(x, y), (x, z) \in R_0 = R$, then $(y, z) \in R^{-1} \circ R$. Thus, $(y, z) \in R_1$
    \item $i = 0$ and $j = k + 1$

    Suppose $(x, y) \in R$ and $(x, z) \in R_{k + 1} = R_{k} \cup ({R_k}^{-1} \circ R_k)$.
    Clearly that $(x, y) \in R_{k + 1}$ as well. It is obviously that $(y, z) \in R_{k + 2}$ since
    $(y, x) \in R_{k + 1}^{-1}$ and $(x, z) \in R_{k + 1}$.

    \item The case with $i = k + 1$ and $j = 0$ is similar to the previous one.

    \item Suppose $i = m + 1$ and $j = k + 1$. That is, $(x, y) \in R_{m + 1} = R_m \cup ({R_m}^{-1} \circ R_m)$ and $(x, z) \in R_{k + 1} = R_k \cup ({R_k}^{-1} \circ R_k)$.
    Consider the following four subcases:
    \begin{enumerate}
      \item Suppose $(x, y) \in R_m$ and $(x, z) \in R_k$ and $m \leq k$ without loss of generality.
      $m \leq k$ implies $R_m \subseteq R_k$ and $(x, y) \in R_k$ in particular. Thus, $(y, z) \in {R_k}^{-1} \circ R_k$, so $(y, z) \in R_{k + 1}$.
      \item The rest of the cases are similar to the first one.
    \end{enumerate}
    \end{enumerate}
\end{proof}

\begin{theorem}
  ${\bf K}45$ admits strict filtrations.
\end{theorem}

\begin{proof}
  Let $\mathcal{M} = \langle W, R, \vartheta \rangle$ be a transitive Euclidean model and $\overline{\mathcal{M}} = \langle \overline{W}, \overline{R}, \overline{\vartheta} \rangle$ its minimal filtration through $\Gamma$, where $\Gamma$ is finite and Sub-closed. Let us put $\widehat{R} = \overline{R}^{+} \cup \overline{R}^{E}$. Let us show that $\overline{R}^{+} \cup \overline{R}^{E} \subseteq \overline{R}^{max}$.

  That is, if $\mathcal{M}, y \models \varphi$ for $\Diamond \varphi \in \Gamma$ and $\hat{x} \widehat{R} \hat{y}$, then $\mathcal{M}, x \models \Diamond \varphi$.

  Let $\hat{x} \widehat{R} \hat{y}$. Let us consider the case when $(\hat{x}, \hat{y}) \in \overline{R}^{E}$

  \begin{enumerate}
    \item Suppose $(\hat{x}, \hat{y}) \in \overline{R}$, then $\mathcal{M}, x \models \Diamond \varphi$ holds trivially by the definition of the minimal filtration.
    \item Suppose the statement holds $\overline{R}_n$ and $(\hat{x}, \hat{y}) \in \overline{R}_{n + 1} = \overline{R}_n \cup (\overline{R}_n^{-1} \circ \overline{R}_n)$. We consider the case of $(\hat{x}, \hat{y}) \in (\overline{R}_n^{-1} \circ \overline{R}_n)$.

    Then there exists $\hat{z}$ such that $(\hat{z}, \hat{x}), (\hat{z}, \hat{y}) \in \overline{R}_n$.

    By IH, $\mathcal{M}, z \models \Diamond \varphi$.

    $(\hat{z}, \hat{y}) \in \overline{R}_n$ iff there are $\hat{u}_1, \dots, \hat{u}_n$ such that

    \vspace{\baselineskip}

    \xymatrix{
    &&& \hat{z} & \ar[l]^{\widehat{R}} \hat{u}_1 \ar[r]_{\widehat{R}'} & \hat{u}_2 \ar[r]_{\widehat{R}'} & \dots \ar[r]_{\widehat{R}'} & \hat{u}_{n - 1} \ar[r]_{\widehat{R}'} & \hat{u}_n \ar[r]_{\widehat{R}} & \hat{y}
    }
    where $\widehat{R}'$ is either $\widehat{R}$ or $\widehat{R}^{-1}$.
  \end{enumerate}
  As it is known, $\Diamond \Diamond \varphi \to \Box \Diamond \varphi \in {\bf K}45$.

  \vspace{\baselineskip}

  $\hat{u}_1 \widehat \hat{z}$, that is, $u_1' R z'$ for some $u_1' \in \hat{u}_1$ and $z' \in \hat{z}$.
  That is, $\mathcal{M}, u_1' \models \Diamond \Diamond \varphi$, so $\mathcal{M}, u_1' \models \Diamond \varphi$ and $\overline{M}, \hat{u}_1 \models \Diamond \varphi$.

  We have $\hat{u}_1 \widehat{R}' \hat{u}_2$. Suppose $\mathcal{M}, u_1'' \models \Diamond \varphi$ and $u_1'' R u_2'$.
  We also have $\mathcal{M}, u_1'' \models \Box \Diamond \varphi$, thus, $\mathcal{M}, u_2' \models \Diamond \varphi$.

  Suppose $\hat{u}_2 \widehat{R} \hat{u}_1$ and $u_2' R u_1''$, then $\mathcal{M}, u_2' \models \Diamond \varphi$.

  Similarly, we have $\mathcal{M}, u_i \models \Diamond \varphi$ iff $\mathcal{M}, u_{i + 1} \models \Diamond \varphi$, whenever $\hat{u}_i \widehat{R}' \hat{u}_{i + 1}$.

  Finally, we have $\hat{u}_n \widehat{R} \hat{x}$. Thus, $u_n' R x'$ for some $u_n' \in \hat{u}_n$ and $x' \in \hat{x}$. $\mathcal{M}, u_n' \models \Diamond \varphi$, so $\mathcal{M}, u_n' \models \Box \Diamond \varphi$. Then $\mathcal{M}, x' \models \Diamond \varphi$.
\end{proof}

\begin{theorem}\label{sad}
  ${\bf K}5$ does not admit strict filtrations.
\end{theorem}

\begin{proof}
  Let us consider a ${\bf K}5$ model whose Euclidean closure of the minimal filtration does not give us a filtration.

  Let us consider a frame called $\mathcal{F}_{bad}$. We define this frame with the following graph:

\vspace{\baselineskip}

  \xymatrix{
  &&&&&&& w_5\ar@(ul,ur) \ar@<-.5ex>[d] \\
  &&&&&& w_1\ar@(ul,ur)  & w_4 \ar@<.5ex>[u] \ar@(dl,ul)^{} \\
  &&&&&& w_2 \ar[u] & w_3 \ar[u]
  }

Let us define a valuation $\vartheta$ such that $\vartheta(p) = \{ w_5\}$ and $\vartheta(q) = \{ w_1\}$. Let us consider a minimal filtration of $\mathcal{M}_{bad}$ through the Sub-closure of $\Gamma = \{ \neg p, \neg \Diamond p\}$.

Clearly that $w_2 \sim_{\Gamma} w_3$, since $\neg p$ and $\neg \Diamond p$ are true both at $w_2$ and $w_3$.

Moreover, $R_{min} \cup (R_{min}^{-1} \circ R_{min})$ is not a subset of $R_{max}$ since $(\hat{w_1}, \hat{w_5}) \in (R_{min}^{-1} \circ R_{min})$, but $\Diamond p$ is not true at $w_5$.

Let us also note that strict filtrations of this model is not Euclidean.
Suppose by contrary that $\widehat{R}^{\mathcal{E}}$ is a strict filtraction of that model. So $R_{min}^E \subseteq \widehat{R}^{\mathcal{E}}$, since $R_{min}^E$ is the minimal Euclidean relation containing $R_{min}$. On the other hand, $R_{min}^E \not\subseteq R_{max}$, so is not $\widehat{R}^{\mathcal{E}}$.

\end{proof}

\section{i,j-Euclideaness}

Let $R$ be a binary relation on $W \neq \emptyset$, then the $i,j$-Euclidean closure of $R$ (where $i, j < \omega$), denoted as $R^{E_{i,j}}$, is a binary relation defined recursively as follows:
\begin{enumerate}
  \item $R_0 = R$
  \item $R_{n + 1} = R_n \cup (((R_n)^{-1})^i \circ {R_n}^j)$
  \item $R^{E_{i,j}} = \bigcup \limits_{k < \omega} R_k$
\end{enumerate}

\begin{prop}
  If $R$ be a binary relation on $W \neq \emptyset$, $R^{E_{i,j}}$ is $i,j$-Euclidean.
\end{prop}
\begin{proof}
  By induction. Let $(x,y_1), (y_1,y_2), (y_2,y_3), \dots, (y_{i - 1},y_i), (x,z_1), (z_1,z_2), (z_2,z_3), \dots, (z_{j - 1},z_j) \in R^{E_{i,j}}$.
  That is, each of these pairs belong to some $R_k$ and every $k < \omega$ for every pair is its own.
  If $k = 0$ for each pair, then $(y_i, z_j) \in R_1$.
  If some those $k$ is non-zero, then we take the greatest amongst them, say $e$ and all given pairs will be elements of $R_{e + 1}$.
\end{proof}

\begin{theorem}
  ${\bf K5}^{i,j} = {\bf K} \oplus \Diamond^{i} p \to \Box^{j} \Diamond p$ admits definable filtrations.
\end{theorem}

\begin{proof}
  Let $\mathcal{M} = \langle W, R, \vartheta \rangle$ and $\Gamma$ a finite $\operatorname{Sub}$-closed of formulas. We extend $\Gamma$ as
  \begin{center}
    $\Delta = \Gamma \cup \operatorname{Sub}\{  \Diamond^{i} \psi \: | \: \Box \psi \in \Gamma \} \cup \operatorname{Sub}\{ \Box^{j} \Diamond \psi \: | \: \Diamond \psi \in \Gamma \}$
  \end{center}
  Let $(\hat{x}, \hat{y}) \in R^{E_{i,j}}$, $\mathcal{M}, x \models \Box \psi$ for $\Box \psi$ in $\Delta$.
  If $n = 0$, then the statement is obvious. Suppose $n = 1$.
  Then $(\hat{x}, \hat{y}) \in R_{min} \cup (((R_{min})^{-1})^i \circ {R_{min}}^j)$. Consider the second alternative. Then there exists $\hat{z}$ such that $(\hat{x}, \hat{z}) \in ((R_{min})^{-1})^i $ and $(\hat{z}, \hat{y}) \in {R_{min}}^j$.

  That is, there are $\hat{x_1}, \hat{x_2}, \dots, \hat{x_i}$ and $\hat{y_1}, \hat{y_2}, \dots, \hat{y_j}$ such that

  \xymatrix{
  &&&& \hat{z} \ar[r]^{R_{min}} & \ar[r]^{R_{min}} \hat{x_1} \ar[r]^{R_{min}} & \hat{x_2} \ar[r]^{R_{min}} & \dots \ar[r]^{R_{min}} & \ar[r]^{R_{min}} \hat{x_i} \ar[r]^{R_{min}} & \hat{x} \\
  &&&& \hat{z} \ar[r]^{R_{min}} & \ar[r]^{R_{min}} \hat{y_1} \ar[r]^{R_{min}} & \hat{y_2} \ar[r]^{R_{min}} & \dots \ar[r]^{R_{min}} & \ar[r]^{R_{min}} \hat{y_j} \ar[r]^{R_{min}} & \hat{y} \\
  }

  ???
\end{proof}

\section{The case of 2-transitivity}


Let us define the logic $\mathcal{L}$ as ${\bf K} \oplus \Diamond \Diamond \Diamond p \to \Diamond p$. Let $R$ be a binary relation, the $\mathcal{L}$-closure of $R$ is defined (denoted as $R^{\davidsstar}$) as the following union:
\begin{center}
  $R^{\davidsstar} = R \cup R^3 \cup R^5 \cup \dots \cup R^{2k+1} \cup \dots$
\end{center}

\begin{theorem}
  $\mathcal{L}$ does not admit strict filtrations.
\end{theorem}

\begin{proof}
  Consider the following frame $\mathcal{F} = \langle W, R \rangle$:

\vspace{\baselineskip}

  \xymatrix{
  &&&&& x \ar@(ur,ul) \ar[r] & y \\
  &&&&&& y_1 \ar[r] \ar@/_/[rr] & z_1 \ar[r] & z \ar@(ur,ul)
  }

\vspace{\baselineskip}

  Clearly that $\mathcal{F}$ is an $\mathcal{L}$-frame. We define the valuation $\vartheta$ as follows:

  \begin{center}
    $\vartheta(p) = \{ x \}$

    $\vartheta(q) = \{ y, y_1 \}$

    $\vartheta(r) = \{ z \}$
  \end{center}
  Let us put $\Gamma = \operatorname{Sub} \{ p, q, \Diamond r \}$. We factorise $W$ through $\sim_{\Gamma}$ and consider a model $\widehat{\mathcal{M}} = \langle W / \sim_{\Gamma}, \widehat{R}, \widehat{\vartheta} \rangle$, where $\widehat{R} = (\widehat{R}_{min})^{\davidsstar}$.
  We have $(\hat{x}, \hat{z}) \in \widehat{R} \circ \widehat{R} \circ \widehat{R}$, but $\Diamond r$ is not true at $x$.
\end{proof}

\section{Finite ``canonical'' models}

Let $\mathcal{L}$ be a normal modal logic, $\mathcal{M}_{\mathcal{L}}$ its canonical model, and $\Gamma$ a finite $\operatorname{Sub}$-closed set of formulas. Let us put $\Gamma' = \operatorname{Sub}(\varphi) \cup \{ \neg \psi \: | \: \psi \in \operatorname{Sub}(\varphi) \}$.

A subset $\Delta \subseteq '\Gamma$ is a \emph{finite $\mathcal{L}$-consistent set} if $\neg \bigwedge \Delta \notin \mathcal{L}$. A subset $\Delta$ is maximal, if (the following are obviously equivalent):
\begin{enumerate}
  \item $\Delta$ is maximal amongst finite $\mathcal{L}$-consistent sets,
  \item For each $\psi \in \operatorname{Sub}(\varphi)$ either $\psi \in \Delta$ or
  $\neg \psi \in \Delta$.
\end{enumerate}

Every finite $\mathcal{L}$-theory is clearly can be extended to some maximal one. It is the finite version of Lindenbaum's lemma.

\begin{defin}\label{fin}
  Let $\mathcal{L}$ be a modal logic and $\Gamma$ be a finite $\operatorname{Sub}$-closed set of formulas. A finite ``canonical'' model is a triple $\mathcal{M}_{\mathcal{L}}^{\Gamma} = \langle W_{\mathcal{L}}^{\Gamma}, R_{\mathcal{L}}^{\Gamma}, \vartheta_{\mathcal{L}}^{\Gamma} \rangle$, where
  \begin{enumerate}
    \item $W_{\mathcal{L}}^{\Gamma}$ is the set all maximal theories that extend finite $\mathcal{L}$-theories
    \item $R_{\mathcal{L}}^{\Gamma}$ is a relation such that
    $\langle W_{\mathcal{L}}^{\Gamma}, R_{\mathcal{L}}^{\Gamma} \rangle$ is an $\mathcal{L}$-frame
    and
    \begin{center}
    $\forall \Box \psi \in \operatorname{Sub}(\varphi) \:\:
    \forall \Delta_1 \in W_{\mathcal{L}}^{\Gamma} \:\: (\Box \psi \in \Delta_1 \Leftrightarrow
    \forall \Delta_2 \in R_{\mathcal{L}}^{\Gamma}(\Delta_1) \:\: \psi \in \Delta_2)$
    \end{center}
    \item $\vartheta_{\mathcal{L}}^{\Gamma}(p) = \{ \Delta \in W_{\mathcal{L}}^{\varphi} \: | \: p \in \Delta \}$ for every variable $p \in \Gamma$.
  \end{enumerate}
\end{defin}

\begin{lemma}\label{good}
  Let $\mathcal{L}$ be a modal logic and $\varphi \not\in \mathcal{L}$, then $\mathcal{M}_{\mathcal{L}}^{\operatorname{Sub}(\varphi)} \nvDash \varphi$.
\end{lemma}

\begin{lemma} Let $\mathcal{L}$ be a modal logic and $\Gamma$ a finite $\operatorname{Sub}$-closed set of formulas, then if $\mathcal{L}$ admits strict filtrations, then there exists a finite ``canonical'' model $\mathcal{M}_{\mathcal{L}}^{\Gamma}$ such that $\mathcal{M}_{\mathcal{L}}^{\Gamma} \models \mathcal{L}$.
\end{lemma}

\begin{proof}
  $ $
$(\Rightarrow)$
  Let $\Gamma$ be a finite $\operatorname{Sub}$-closed of formulas. $\mathcal{L}$ admits strict filtrations, so the filtration of the canonical model $\mathcal{M}_{\mathcal{L}}$ through $\Gamma$ is also an $\mathcal{L}$-model. The underlying set of $\mathcal{M}_{\mathcal{L}} / \sim_{\Gamma}$ consists of maximal $\mathcal{L}$ theories up to $\Gamma$-equivalence and this quotient set is finite.

  It is readily checked that the quotient model $\mathcal{M}_{\mathcal{L}} / \sim_{\Gamma}$ satifsfies Definition~\ref{fin}.
\end{proof}

The converse implication does not have to true generally. ${\bf GL}$ might be an example of a logic that has the ``finite canonical'' model property with no filtrations.

\section{Fusion stuff}

\begin{defin}
  Let $\mathcal{L}_1$ and $\mathcal{L}_2$ be modal logics, then the fusion $\mathcal{L}_1 * \mathcal{L}_2$ is the minimal bimodal logic that contains $\mathcal{L}_1$ and $\mathcal{L}_2$ \cite{kurucz200715}.
\end{defin}

\begin{lemma}\label{extension}
  $ $

  \begin{itemize}
  \item Let $\Gamma$ be a finite and $\operatorname{Sub}$-closed set of formulas and $\mathcal{M} = \langle W, R, \vartheta \rangle$. Consider $\Gamma' = \Gamma \cup \{ \Diamond \Box \psi \: | \: \Box \psi \in \Gamma \}$. Let $\Delta$ be any finite and $\operatorname{Sub}$-closed extension of $\Gamma'$. Then a model $\widehat{M} = \langle W / \sim_{\Delta}, (R^{min}_{\Delta})^{E}, \widehat{\vartheta} \rangle$ is a filtration of $\mathcal{M}$ through $\Delta$.
  \item The same for ${\bf K} \oplus \Diamond \Diamond \Diamond p \to \Diamond p$
  \end{itemize}
\end{lemma}

\begin{proof}
  Recall that $(R^{min}_{\Delta})^{E}$ is defined inductively as:
  \begin{enumerate}
    \item $R_{\Delta}^{0} = R_{\Delta}^{min}$
    \item $R_{\Delta}^{n + 1} = R_{\Delta}^{n} \cup ({R_{\Delta}^{n}}^{-1} \circ R_{\Delta}^{n})$
    \item $(R^{min}_{\Delta})^{E} = \bigcup_{k < \omega} R_{\Delta}^{k}$
  \end{enumerate}

  If $R^{min}_{\Delta}$ is already a subrelation of $R^{max}$, so the base case is self-evident.

  Suppose the statement holds for $R_{\Delta}^{n}$, $(\hat{x},\hat{y}) \in R_{\Delta}^{n + 1}$, that is, there exists $\hat{z}$ such that $(\hat{z}, \hat{x}), (\hat{z}, \hat{y}) \in R_{\Delta}^{n}$.
  Let $\mathcal{M}, x \models \Box \psi$ (for $\Box \psi \in \Gamma$).

  We rewrite $(\hat{z}, \hat{x}) \in R_{\Delta}^{n}$ as the following sausage (for some $\widehat{u_1},  \widehat{u_2}, \dots, \widehat{u_{n - 1}}, \widehat{u_{n}}$):

  \xymatrix{
  &&& \hat{z} & \ar[l]_{R_{\Delta}^{min}} \ar[r]^{R'} \widehat{u_1} & \ar[r]^{R'} \widehat{u_2} \ar[r]^{R'} & \dots \ar[r]^{R'} & \widehat{u_{n - 1}} \ar[r]^{R'} & \widehat{u_{n}} \ar[r]^{R_{\Delta}^{min}} & \hat{x}
  }
  where $R'$ is either $R_{\Delta}^{min}$ or its converse. We have $\mathcal{M}, z \models \Box \psi$, since $\mathcal{M}, x \models \Box \psi$ implies $\mathcal{M}, u_{n} \models \Diamond \Box \psi$. After that we apply the following property of ${\bf K}5$-models:
  \begin{center}
    For each $a, b \in M_i$ such that $a R_i b$ we have $\mathcal{M}_i, a \models \Diamond \Box p_{\psi}$ iff $\mathcal{M}_i, b \models \Diamond \Box p_{\psi}$
  \end{center}
  Note that we always stay within $\Delta$ since $\Gamma' \subseteq \Delta$.
  Finally, we conclude $\mathcal{M}, x \models \psi$ from IH and $\mathcal{M}, z \models \Box \psi$.

  The second item is shown similarly.
\end{proof}

\begin{theorem}
  $ $

  \begin{enumerate}
  \item ${\bf K}5 * {\bf K}5$ admits definable filtrations.
  \item ${\bf K}5 * \dots * {\bf K}5$ admits definable filtrations.
  \item If $\mathcal{L}$ admits strict filtrations, then ${\bf K}5 * \mathcal{L}$ admits definable filtrations
  \item If $\mathcal{L}_1, \dots, \mathcal{L}_n$ admit strict filtrations, then ${\bf K}5 * \dots * \dots * {\bf K}5 * \mathcal{L}_1 * \dots * \mathcal{L}_n$
  \item Let $\mathcal{L} = {\bf K} \oplus \Diamond \Diamond \Diamond p \to \Diamond p$  (here and below), then $\mathcal{L} * \mathcal{L}$ admits definable filtrations.
  \item Let $\mathcal{L} = {\bf K} \oplus \Diamond \Diamond \Diamond p \to \Diamond p$ and $\mathcal{L}_1$ a logic that admits strict filtrations, then $\mathcal{L} * \mathcal{L}_1$
  \end{enumerate}
\end{theorem}

\begin{proof}
$ $

  \begin{enumerate}
  \item Let $\Gamma$ be a finite $\operatorname{Sub}$-closed set of bimodal formulas,
  $\mathcal{F} = \langle W, R_1, R_2 \rangle$ a ${\bf K}5 * {\bf K}5$-frame, and $\vartheta$ a valuation on $\mathcal{F}$. Denote $\langle \mathcal{F}, \vartheta \rangle$ as $\mathcal{M}$.

  We introduce the set of fresh variables $V = \{ p_{\psi} \: | \: \psi \in \Gamma \}$ and define a new model $\mathcal{M}' = \langle \mathcal{F}, \vartheta' \rangle$ as follows:
  \begin{center}
    For all $\psi \in \Gamma$, $\mathcal{M}, x \models \psi \Leftrightarrow \mathcal{M}', x \models \psi \Leftrightarrow \mathcal{M}', x \models p_{\psi}$.
  \end{center}

  Consider these modifications of $\Gamma$ and $V$:

  \begin{center}
    $\Gamma' = \Gamma \cup \{ \Diamond_1 \Box_1 \psi \: | \: \Box_1 \psi \in \Gamma \} \cup \{ \Diamond_2 \Box_2 \psi \: | \: \Box_2 \psi \in \Gamma \}$

    $\Delta = V \cup \operatorname{Sub}(\{ \Diamond \Box p_{\psi} \: | \: \Box_i \psi \in \Gamma, i n= 1,2 \})$
  \end{center}
  Let us define an equivalence relation $\sim_{\Delta}$ induced by $\Delta$.

  Consider $\mathcal{M}_i = \langle W, R_i, \vartheta' \rangle$, a reduct of $\mathcal{M}'$, we have:
  \begin{enumerate}
    \item $\mathcal{M}_i, x \models \Box p_{\psi}$ iff $\mathcal{M}, x \models \Box_i \psi$
    \item $\mathcal{M}_i, x \models \Diamond \Box p_{\psi}$ iff $\mathcal{M}, x \models \Diamond_i \Box_i \psi$
  \end{enumerate}
  So $\sim = \sim_{\Gamma'}$ by the construction. Let us put $\widehat{W} = W / \sim_{\Gamma'}$. Lemma~\ref{extension} implies the following claim:

  \begin{claim}
    Let $\widehat{R}_i = (R^{min}_{\Delta})^{E}$ and
    $\widehat{\vartheta(p)} = \{ [x]_{\sim_i} \: | \: \mathcal{M}_i, x \models p \}$ for $p \in \Delta_1$, define $\widehat{\mathcal{M}}_i = \widehat{W}, \widehat{R}_i, \widehat{\vartheta}$. Then $\widehat{\mathcal{M}}_i \models {\bf K}5$ and $\widehat{\mathcal{M}}_i$ is a filtration of $\mathcal{M}_i$ through $\Delta$.
  \end{claim}

  Finally, we consider a model $\widehat{\mathcal{M}} = \langle \widehat{W}, \widehat{R}_1, \widehat{R}_2, \vartheta \rangle$, where $\widehat{R_{\Gamma'}}_i = {{R_i}^{min}_{\Gamma'}}^E$ and $\vartheta(p)$ is defined as usual for $p \in \Gamma$. $\widehat{\mathcal{M}}$ is a filtration of $\mathcal{M}$ through $\Gamma'$.

  Let $\hat{x} \widehat{R_{\Gamma'}}_i \hat{y}$ and $\mathcal{M}, x \models \Box_i \psi$ for $\Box_i \psi \in \Gamma$. Then $\mathcal{M}_i, x \models \Box p_{\psi}$, so $\widehat{\mathcal{M}_i}, \hat{x} \models \Box p_{\psi}$.
  By the claim above, $\widehat{\mathcal{M}_i}$ is a filtration of $\mathcal{M}_i$ through $\Delta$, so $\mathcal{M}_i, y \models p_{\psi}$. Then $\mathcal{M}, y \models \psi$.

  \item Likewise
  \item The argument is the same as in the proof of the first item, except for {\bf Claim} 1 that has the following formulation:
  Let $\widehat{R}_1 = (R^{min}_{\Delta})^{E}$ and $\widehat{R}_2 = (R^{min}_{\Delta})^{\mathcal{L}_1}$
  Define a valuation as usual as $\widehat{\vartheta(p)} = \{ [x]_{\sim_i} \: | \: \mathcal{M}_i, x \models p \}$ for $p \in \Delta_1$, define $\widehat{\mathcal{M}}_1 = \langle \widehat{W}, \widehat{R}_1, \widehat{\vartheta} \rangle$ and $\widehat{\mathcal{M}}_2 = \langle \widehat{W}, \widehat{R}_2, \widehat{\vartheta} \rangle$.

  Then $\widehat{\mathcal{M}}_1 \models {\bf K}5$ and $\widehat{\mathcal{M}}_1 \models {\bf L}$ and $\widehat{\mathcal{M}}_i$ is a filtration of $\mathcal{M}_i$ through $\Delta$.

  \item Likewise
  \item The argument is similar to the proof of first item, but filtrations are slightly different.
  Let $\mathcal{M} = \langle W, R_1, R_2, \vartheta \rangle$ be a $\mathcal{L} * \mathcal{L}$ model and $\Gamma$ a $\operatorname{Sub}$-closed set of formulas. As above, we define a set $V$ and a model $\mathcal{M}'$. Define extensions of $\Gamma$ and $V$:

  \begin{center}
    $\Gamma' = \Gamma \cup \{ \Diamond_1 \Diamond_1 \psi \: | \: \Diamond_1 \psi \in \Gamma \} \cup \{ \Diamond_2 \Diamond_2 \psi \: | \: \Diamond_2 \psi \in \Gamma \}$

    $\Delta = V \cup \operatorname{Sub}(\{ \Diamond \Diamond p_{\psi} \: | \: \Diamond \psi \in \Gamma, i = 1,2 \})$
  \end{center}
  As above $\sim_{\Delta} = \Gamma'$ and $\widehat{\mathcal{M}'} = \langle W /\sim_{\Delta}, \widehat{R_i}, \widehat{\vartheta} \rangle$ are filtrations of reducts of $\mathcal{M}'$ through $\Delta$. Then $\widehat{\mathcal{M}} = \langle W /\sim_{\Delta}, \widehat{R_1}, \widehat{R_2}, \widehat{\vartheta} \rangle$ is a required filtration of the original $\mathcal{M}$.
  \item Extend $\Gamma$ with $\{ \Diamond_i \Diamond_i \psi \: | \: \Diamond_i \psi \in \Gamma, i = 1,2 \}$ and
  $V$ with $\{\Diamond \Diamond p_{\psi} \: | \: \Diamond_i {\psi}, i = 1, 2\}$
  \end{enumerate}
\end{proof}

\begin{theorem}
  Let $\mathcal{L}_1$ and $\mathcal{L}_2$ be modal logics that admit definable filtrations. If $\operatorname{Mod}(\mathcal{L}_1)$ and $\operatorname{Mod}(\mathcal{L}_2)$ admit definable filtrations, so does $\operatorname{Mod}(\mathcal{L}_1 * \mathcal{L}_2$).
\end{theorem}

\begin{proof}
  Let $\mathcal{M} = \langle W, R_1, R_2, \vartheta \rangle$ be an $\mathcal{L}_1 * \mathcal{L}_2$.
  We define a notation $\nabla = \{ \neg \Diamond, \Diamond \neg, \Diamond \}$.

  Both logics admit definable filtrations, so for every finite $\operatorname{Sub}$-closed set $\Gamma$ and for every $\mathfrak{M}$, an $\mathcal{L}_1$-model (or an $\mathcal{L}_2$ one) there exists there exists $\Delta$, a extension of $\Gamma$ having the form:
  \begin{center}
    $\Delta_1 = \Gamma \cup \operatorname{Sub}\{ \nabla_1 \nabla_2 \dots \nabla_n \Diamond \psi \: | \: \Diamond \psi \in \Gamma \}$ (for $\mathcal{L}_1$)

    $\Delta_2 = \Gamma \cup \operatorname{Sub}\{ \nabla_1 \nabla_2 \dots \nabla_k \Diamond \psi \: | \: \Diamond \psi \in \Gamma \}$ (for $\mathcal{L}_2$)
  \end{center}
  such that $\widehat{\mathfrak{M}} = \langle W / \sim_{\Delta_i}, \widehat{R}, \vartheta \rangle$ is a filtration of $\mathfrak{M}$ through the corresponding $\Delta_i$.

  Let $V$ be a set of fresh variables indexed over $\Gamma$ as in the proof for a fusion of ${\bf K5}$ with something else. Let $\mathcal{M}'$ be a model defined as previously. We extend $V$ and $\Gamma$ in the following way:

\begin{center}
  $\Gamma' = \Gamma \cup \operatorname{Sub}\{ {\nabla_1}_1 {\nabla_2}_1 \dots {\nabla_n}_1 \Diamond_1 \psi \: | \: \Diamond_1 \psi \in \Gamma \} \cup \operatorname{Sub}\{ {\nabla_1}_2 {\nabla_2}_2 \dots {\nabla_n}_2 \Diamond_2 \psi \: | \: \Diamond_2 \psi \in \Gamma \}$

  $\Delta = V \cup \operatorname{Sub}\{ \nabla_1 \nabla_2 \dots \nabla_n \Diamond p_{\psi} \: | \: {\nabla_{n + 1}}_1 \psi \in \Gamma' \} \cup \operatorname{Sub}\{ \nabla_1 \nabla_2 \dots \nabla_k \Diamond p_{\psi} \: | \: \Diamond_2 \psi \in \Gamma \}$.
\end{center}
By the construction, $\sim_{\Gamma'} = \sim_{\Delta}$. So we have filtrations for the corresponding reducts of $\mathcal{M}'$ through $\Delta$ as well as for the original $\mathcal{M}$.
\end{proof}

\bibliographystyle{plain}
\bibliography{Text}


\end{document}
